
<!--
 DO NOT EDIT.
 THIS FILE WAS AUTOMATICALLY GENERATED BY mkdocs-gallery.
 TO MAKE CHANGES, EDIT THE SOURCE PYTHON FILE:
 "docs/scripts/project/problem1.py"
 LINE NUMBERS ARE GIVEN BELOW.
-->

!!! note

    Click [here](#download_links)
    to download the full example code


Problem 1 : Optimization

<!-- GENERATED FROM PYTHON SOURCE LINES 5-25 -->

```{.python }

from numpy import array
import pickle
from pathlib import Path

from lh2pac.gemseo.discipline import H2TurboFan
from lh2pac.gemseo.utils import draw_aircraft
from lh2pac.gemseo.utils import get_aircraft_data

from gemseo import configure_logger
from gemseo import create_scenario
from gemseo import create_surrogate
from gemseo import import_discipline
from gemseo import configure
from gemseo.algos.design_space import DesignSpace
from gemseo.mlearning.quality_measures.r2_measure import R2Measure
from gemseo.mlearning.quality_measures.rmse_measure import RMSEMeasure
from lh2pac.marilib.utils import unit

#configure(activate_discipline_counters=False, activate_function_counters=False, activate_progress_bar=True, activate_discipline_cache=True, check_input_data=False, check_output_data=False, check_desvars_bounds=False)
```

<!-- GENERATED FROM PYTHON SOURCE LINES 26-28 -->

## Airplane initialization
First, we instantiate the discipline:

<!-- GENERATED FROM PYTHON SOURCE LINES 28-30 -->

```{.python }
discipline = H2TurboFan()

```

<!-- GENERATED FROM PYTHON SOURCE LINES 31-33 -->

Then,
we can have a look at its input names:

<!-- GENERATED FROM PYTHON SOURCE LINES 33-35 -->

```{.python }
discipline.get_input_data_names()

```

<!-- GENERATED FROM PYTHON SOURCE LINES 36-37 -->

output names:

<!-- GENERATED FROM PYTHON SOURCE LINES 37-40 -->

```{.python }
output_parameters = discipline.get_output_data_names()
print(output_parameters)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 41-42 -->

and default input values:

<!-- GENERATED FROM PYTHON SOURCE LINES 42-44 -->

```{.python }
discipline.default_inputs

```

<!-- GENERATED FROM PYTHON SOURCE LINES 45-46 -->

and execute the discipline with these values:

<!-- GENERATED FROM PYTHON SOURCE LINES 46-48 -->

```{.python }
discipline.execute()

```

<!-- GENERATED FROM PYTHON SOURCE LINES 49-50 -->

We can print the aircraft data:

<!-- GENERATED FROM PYTHON SOURCE LINES 50-53 -->

```{.python }
aircraft_data = get_aircraft_data(discipline)
print(aircraft_data)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 54-55 -->

and draw the aircraft:

<!-- GENERATED FROM PYTHON SOURCE LINES 55-57 -->

```{.python }
draw_aircraft(discipline, "The default A/C")

```

<!-- GENERATED FROM PYTHON SOURCE LINES 58-60 -->

## Design of experiment
we activate the logger.

<!-- GENERATED FROM PYTHON SOURCE LINES 60-74 -->

```{.python }
configure_logger()

# we create the design space for design parameters $x$ :
class MyDesignSpace(DesignSpace):
    def __init__(self):
        super().__init__(name="design_parameters_space")
        self.add_variable("thrust", l_b=unit.N_kN(100), u_b=unit.N_kN(150))
        self.add_variable("bpr", l_b=5, u_b=12)
        self.add_variable("area", l_b=120, u_b=200)
        self.add_variable("aspect_ratio", l_b=7, u_b=12)

design_space = MyDesignSpace()


```

<!-- GENERATED FROM PYTHON SOURCE LINES 75-77 -->

Thirdly,
we create a `DOEScenario` from this discipline and this design space:

<!-- GENERATED FROM PYTHON SOURCE LINES 77-84 -->

```{.python }
disciplines = [discipline]
scenario = create_scenario(
    disciplines, "DisciplinaryOpt", output_parameters[0], design_space, scenario_type="DOE"
)
for parameter in  output_parameters[1:] :
    scenario.add_observable(parameter)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 85-87 -->

Now,
we can sample the discipline to get 100 evaluations of the airplane parameters :

<!-- GENERATED FROM PYTHON SOURCE LINES 87-89 -->

```{.python }
scenario.execute({"algo": "OT_OPT_LHS", "n_samples": 100})

```

<!-- GENERATED FROM PYTHON SOURCE LINES 90-94 -->

Lastly,
we can export the result to an `IODataset`
which is a subclass of `Dataset`,
which is a subclass of `pandas.DataFrame`:

<!-- GENERATED FROM PYTHON SOURCE LINES 94-97 -->

```{.python }
dataset = scenario.to_dataset(opt_naming=False)
dataset

```

<!-- GENERATED FROM PYTHON SOURCE LINES 98-100 -->

## Surrogate modeling
before creating a surrogate discipline:

<!-- GENERATED FROM PYTHON SOURCE LINES 100-102 -->

```{.python }
surrogate_discipline = create_surrogate("RBFRegressor", dataset)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 103-104 -->

and using it for prediction:

<!-- GENERATED FROM PYTHON SOURCE LINES 104-107 -->

```{.python }
surrogate_discipline.execute({"x": array([1.0])})
surrogate_discipline.cache.last_entry

```

<!-- GENERATED FROM PYTHON SOURCE LINES 108-111 -->

This surrogate discipline can be used in a scenario.
The underlying regression model can also be assessed,
with the R2 measure for instance:

<!-- GENERATED FROM PYTHON SOURCE LINES 111-115 -->

```{.python }
r2 = R2Measure(surrogate_discipline.regression_model, True)
print(r2.compute_learning_measure())
print(r2.compute_cross_validation_measure())

```

<!-- GENERATED FROM PYTHON SOURCE LINES 116-117 -->

or with the root mean squared error:

<!-- GENERATED FROM PYTHON SOURCE LINES 117-121 -->

```{.python }
rmse = RMSEMeasure(surrogate_discipline.regression_model, True)
print(rmse.compute_learning_measure())
print(rmse.compute_cross_validation_measure())

```

<!-- GENERATED FROM PYTHON SOURCE LINES 122-123 -->

Saving model and testing

<!-- GENERATED FROM PYTHON SOURCE LINES 123-130 -->

```{.python }
with Path("my_surrogate.pkl").open("wb") as f:
    pickle.dump(surrogate_discipline, f)

surrogate_discipline = import_discipline("my_surrogate.pkl")
surrogate_discipline.execute({"x": array([1.0])})
surrogate_discipline.get_output_data()

```

<!-- GENERATED FROM PYTHON SOURCE LINES 131-137 -->

Thirdly,
we put these elements together in a scenario
to minimize the Rosenbrock function
under the constraint that the distance
between the design point and the solution of the unconstrained problem
is greater or equal to 1.

<!-- GENERATED FROM PYTHON SOURCE LINES 137-149 -->

```{.python }
scenario_surrogate = create_scenario([surrogate_discipline], "DisciplinaryOpt", "mtow", design_space)
for parameter in  output_parameters[1:] :
    scenario.add_observable(parameter)

scenario_surrogate.add_constraint("tofl", constraint_type="ineq", positive=False, value=2200)
scenario_surrogate.add_constraint("vapp", constraint_type="ineq", positive=False, value=unit.mps_kt(137))
scenario_surrogate.add_constraint("vz_mcl", constraint_type="ineq", positive=True, value=unit.mps_ftpmin(300))
scenario_surrogate.add_constraint("vz_mcr", constraint_type="ineq", positive=True, value=unit.mps_ftpmin(0))
scenario_surrogate.add_constraint("oei_path", constraint_type="ineq", positive=True, value=0.011)
scenario_surrogate.add_constraint("ttc", constraint_type="ineq", positive=False, value=unit.s_min(25))
scenario_surrogate.add_constraint("far", constraint_type="ineq", positive=False, value=13.4)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 150-151 -->

before executing it with a gradient-free optimizer:

<!-- GENERATED FROM PYTHON SOURCE LINES 151-153 -->

```{.python }
scenario_surrogate.execute({"algo": "NLOPT_COBYLA", "max_iter": 1000})

```

<!-- GENERATED FROM PYTHON SOURCE LINES 154-156 -->

Lastly,
we can plot the optimization history:

<!-- GENERATED FROM PYTHON SOURCE LINES 156-158 -->

```{.python }
scenario_surrogate.post_process("OptHistoryView", save=False, show=True)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 159-160 -->

We can print and save the optimized aircraft data:

<!-- GENERATED FROM PYTHON SOURCE LINES 160-166 -->

```{.python }
optimized_design_parameters = surrogate_discipline.get_input_data()
print(optimized_design_parameters)

with Path("design_parameters.pkl").open("wb") as f:
    pickle.dump(optimized_design_parameters, f)

```

<!-- GENERATED FROM PYTHON SOURCE LINES 167-168 -->

and draw the aircraft:

<!-- GENERATED FROM PYTHON SOURCE LINES 168-171 -->

```{.python }
draw_aircraft(optimized_design_parameters, "The optimized A/C")


```


**Total running time of the script:** ( 0 minutes  0.000 seconds)

<div id="download_links"></div>



[:fontawesome-solid-download: Download Python source code: problem1.py](./problem1.py){ .md-button .center}

[:fontawesome-solid-download: Download Jupyter notebook: problem1.ipynb](./problem1.ipynb){ .md-button .center}


[Gallery generated by mkdocs-gallery](https://mkdocs-gallery.github.io){: .mkd-glr-signature }
